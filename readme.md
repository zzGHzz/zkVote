# A Privacy-Preserved Voting Protocol - Off-Chain Operations

## Introduction

This Go package implements the off-chain operations related the voting protocol described in [here](https://github.com/zzGHzz/zkVoteContract/blob/master/protocol.md). By default, the package uses the [P256 or Secp256r1](https://www.secg.org/sec2-v2.pdf) elliptic curve (EC) which is also used by [contracts](https://github.com/zzGHzz/zkVoteContract) developed for implementing the on-chain operations of the protocol.


## Installation

Clone the repository:

```
git clone https://github.com/zzGHzz/zkVote.git
```

Build the binary:

```
cd zkVote
go build ./cmd/zkvote
```

## Usage

Note that all big numbers should be represented by hex-number strings starting with `0x`.

### Generate a new key

```
bin/zkvote gen-priv-key -o <FILE>
```

The output is a JSON file including the following fields:

* `k` - private key 
* `x`, `y` - public key 

### Generate encrypted yes/no ballot 

```
bin/zkvote gen-bin-ballot -i <FILE1> -o <FILE2> 
```

`FILE1` is a json file that includes the following fields:

* `gkx`, `gky` - authority public key 
* `data` - array that include data provided by multiple voters 
  * `a` - private key generated for voting
  * `address` - address of the account to be used to cast the ballot 
  * `v` - integer ballot value: 1 for yes and 0 for no 

`FILE2` is a json file that contains an array of ballots each of which includes the following fields:

* `hx`, `hy` - public key of the voting key generated by the voter 
* `yx`, `yy` - encrypted decision (yes/no)
* `proof` - zero-knowledge proof that proves the encrypted value is either 0 or 1. It further includes fields:
  * `data` - address of the account the voter will use to cast his/her ballot
  * `d1`, `r1`, `d2`, `r2`, `a1x`, `a1y`, `b1x`, `b1y`, `a2x`, `a2y`, `b2x`, `b2y` - proof contents

### Verify encrypted ballots

```
bin/zkvote ver-bin-ballot -i <FILE> -o <DIR>
```

`FILE` is a json file that contains an array of ballots.

`DIR` is the output directory where two files will be created: 

* `invalid-bin-addrs.json` identifies all the invalid ballots by voting account addresses
* `valid-bin-ballot.json` contains all the valid ballots in the same format as `FILE`

### Tally

```
bin/zkvote tally -i <FILE1> -i <FILE2> -o <DIR>
```

`FILE1` is a json file that contains an array of ballots.

`FILE2` is a json file that includes the following fields:

* `k` - authority private key
* `gkx`, `gky` - authority public key
* `address` - address of the account the authority will use to interact with the voting contract

`DIR` is the output directory where two files will be created:

* `bin-tall-res.json` contains the tally result which includes the following fields:
  * `v` - total number of ballots that vote yes
  * `xx`, `xy`, `yx`, `yy` - values used to prove the correctness of `v`
  * `proof` - zero-knowledge proof that proves the correctness of `xx`, `xy`
* `invalid-bin-addrs.json` identifies all the invalid ballots by voting account addresses